. $TRDIR/setup_page_migration.sh

NUMA_NODE=2
HUGEPAGESIZE=2048 # kB
HUGETLB=100
EXPECTED_RETURN_CODE="START MIGRATION_PASSED HUGEPAGE_MIGRATED EXIT"
TEST_PROGRAM="$test_alloc_generic -a numa_prepared -o page_migration -s migratepages -N 10 -B hugetlb_anon -w start -w after_allocate -w before_free -w exit"
MIGRATE_SRC=migratepages

CGROUP=cpu,memory,hugetlb:test1

_prepare() {
    prepare_hugepage_migration || return 1
	cgset -r memory.move_charge_at_immigrate=1 test1
}
