. $TRDIR/setup_page_migration.sh

NUMA_NODE=2
HUGEPAGESIZE=2048 # kB
HUGETLB=500
EXPECTED_RETURN_CODE="START EXIT"

_control() {
	grep ^pgmigrate /proc/vmstat | tee $TMPD/vmstat.pgmigrate1
    for i in $(seq 5) ; do
        $iterate_hugepage_mmap_fault_munmap 10 &
        local pidhuge=$!
        $iterate_numa_move_pages 10 $pidhuge &
        local pidmove=$!
        sleep 7
        kill -SIGUSR1 $pidhuge $pidmove 2> /dev/null
    done
	grep ^pgmigrate /proc/vmstat | tee $TMPD/vmstat.pgmigrate2
    set_return_code EXIT
}

_prepare() {
	prepare_hugepage_migration || return 1
}

_cleanup() {
	cleanup_hugepage_migration
}

_check() {
	check_hugepage_migration
}
